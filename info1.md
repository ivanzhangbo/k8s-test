承知しました。いただいた前提をもとに、「POD 前段のロードバランシング設計方針」の章として整理しました。方式設計書にそのまま記載できるレベルでまとめています。

---

# POD前段ロードバランシング設計方針（GKE移行対応）

## 1. 基本方針

* オンプレミス環境では **Akamai → ALB → Nginx Pod** という構成を採用している。
* GKE 移行後も、**Akamai との接続点として ALB を維持**し、既存構成の互換性を確保する。
* GKE における ALB 作成方式や、内部通信におけるロードバランシング方式は複数の実現手段があるため、**詳細設計フェーズで比較検討を行い、要件（可用性・運用性・コスト）に従って決定**する。

---

## 2. ALB 配置パターンと作成方式

### (1) 外部公開用（Nginx Pod 前段）

* **Akamai CDN → ALB → Nginx Pod**
* ALB 作成方式は 2 パターンを候補とする：

  1. **Gateway/Ingress からの ALB 自動作成**

     * GKE 標準の Ingress/Gateway API を利用し、Service をバックエンドとしたマネージド ALB を自動作成。
     * メリット：管理が Kubernetes マニフェストに一元化される。
     * デメリット：高度な ALB 設定の自由度が制約される。
  2. **手動 ALB 作成＋Service(NodePort) バックエンド連携**

     * GCP コンソールや IaC で ALB を手動構築し、Service(NodePort) をバックエンドに登録。
     * メリット：細かい ALB 設定や既存運用手順を踏襲可能。
     * デメリット：K8S のリソースと分離するため、運用二重化のリスクあり。
* どちらを採用するかは **詳細設計フェーズにて個別検討**する。

---

### (2) 内部通信用（Vue Pod ↔ Front Pod）

* **内部 ALB 作成** または **GKE 内部 Service（ClusterIP/Internal LoadBalancer）利用**の2案を検討。

  * **内部 ALB**

    * メリット：オンプレや他VPCとの連携、Akamai 以外の外部システム接続が将来必要な場合に有効。
    * デメリット：構築・運用がやや複雑。
  * **GKE Service (ClusterIP/Internal LoadBalancer)**

    * メリット：Kubernetes ネイティブでシンプルに構成可能。
    * デメリット：クラスタ外アクセスとの連携は制約あり。
* 採用方針は **対象システムの通信要件を精査の上で詳細設計にて決定**する。

---

## 3. ヘルスチェック方針

* ALB を Gateway/Ingress から作成する場合、**ヘルスチェック方式は複数の選択肢が存在**する：

  * **readinessProbe 推論方式**（Pod の readinessProbe 定義をヘルスチェックに自動反映）
  * **BackendConfig による明示指定**（HTTP path, port, interval などを個別定義）
  * **デフォルトチェック（`/`パス, 80 番など）**（readiness 設定が不十分な場合のフォールバック）
* 各方式は可用性／運用性に差異があるため、**詳細設計で個別検討の上、採用方式を明確化**する。
* 原則方針：

  * Pod 側の `readinessProbe` と ALB のヘルスチェックは **一致させる**（判定の不一致による不具合防止）。
  * 複数プローブがある場合は BackendConfig で統一。

---

## 4. まとめ

* **外部接続（Akamai側）**：ALB を継続利用、作成方式は *Gateway/Ingress 自動作成* または *手動作成＋NodePort* の2案 → 詳細設計で検討。
* **内部通信（Vue ↔ Front Pod）**：内部 ALB か GKE Service の利用を比較検討 → 詳細設計で決定。
* **ヘルスチェック**：readinessProbe／BackendConfig を前提に設計、詳細方式は別途要件ごとに検討。

---

👉 この記載を「ロードバランシング設計方針」の章に追加すれば、現行踏襲＋GKE 移行時の検討軸を整理できます。

---

ご希望あれば、このまま表形式（候補方式／メリット／デメリット／決定タイミング）に整形しましょうか？
